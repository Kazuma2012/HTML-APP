
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ãƒ›ãƒ¼ãƒ </title>
  <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/1/19/Google_Classroom_Logo.svg" />  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; }
    #landing { display: flex; justify-content: center; align-items: center; height: 100vh; }
    #landing button { padding: 20px 40px; font-size: 24px; border-radius: 10px; border: none; background: #4CAF50; color: white; cursor: pointer; }
    #landing button:hover { background: #45a049; }
  </style>
</head>
<body>
  <!-- ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
  <div id="landing">
    <button onclick="launchApp()">ã‚¢ãƒ—ãƒªã‚’èµ·å‹•</button>
  </div>

  <script>
    function launchApp() {
      // Bobãƒ–ãƒ©ã‚¦ã‚¶UI
      const appHTML = `
        <div id="app">
          <div id="toolbar">
            <button class="toolbar-btn" onclick="goBack()">â†æˆ»ã‚‹</button>
            <button class="toolbar-btn" onclick="goForward()">â†’é€²ã‚€</button>
            <button class="toolbar-btn" onclick="reloadPage()">ğŸ”„å†èª­ã¿è¾¼ã¿</button>
            <input id="url" placeholder="https://example.com">
            <button class="toolbar-btn" onclick="loadBobURL()">è¡¨ç¤º</button>
            <div id="spinner">â³ èª­ã¿è¾¼ã¿ä¸­...</div>
          </div>
          <iframe id="viewer" sandbox="allow-scripts allow-same-origin"></iframe>
        </div>
      `;

      // Bobãƒ–ãƒ©ã‚¦ã‚¶ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
      const appScript = `
     const proxy = "https://corsproxy.io/?";

        const historyStack = [];
        let historyIndex = -1;

        async function loadBobURL(url = null, pushHistory = true) {
          if(!url) url = document.getElementById("url").value;
          if(!url) return alert("URLã‚’å…¥åŠ›ã—ã¦ã­");
          document.getElementById("spinner").style.display = "inline";
          try {
            const res = await fetch(proxy + encodeURIComponent(url));
            let html = await res.text();
            html = html.replace(/(src|href|srcset)=["'](http[^"']+)["']/g, (m,a,link)=>\`\${a}="\${proxy + encodeURIComponent(link)}"\`);
            html = html.replace(/<script\\s+src=["'](http[^"']+)["']/g, (m,link)=>\`<script src="\${proxy + encodeURIComponent(link)}"\`);
            html = html.replace(/<a\\s+([^>]*?)href=["'](http[^"']+)["']/g, (m,attrs,link)=>\`<a \${attrs} href="javascript:void(0)" onclick="parent.loadBobURLForLink('\${link}')"\`);
            html = html.replace(/<form\\s+([^>]*?)action=["'](http[^"']+)["']/g, (m,attrs,link)=>\`<form \${attrs} onsubmit="parent.loadBobURLForLink(this.action); return false;"\`);

            const iframe = document.getElementById("viewer");
            iframe.srcdoc = html;

            iframe.onload = () => {
              const doc = iframe.contentDocument || iframe.contentWindow.document;
              const observer = new MutationObserver(() => {
                const links = doc.querySelectorAll('a[href^="http"]');
                links.forEach(a => a.onclick = e => { e.preventDefault(); loadBobURLForLink(a.href); });
                const forms = doc.querySelectorAll('form[action^="http"]');
                forms.forEach(f => f.onsubmit = e => { e.preventDefault(); loadBobURLForLink(f.action); });
              });
              observer.observe(doc.body, { childList: true, subtree: true });
            };

            if(pushHistory){
              historyStack.splice(historyIndex + 1);
              historyStack.push(url);
              historyIndex++;
            }

            document.getElementById("url").value = url;

          } catch(err){
            alert("å–å¾—å¤±æ•—: " + err);
          } finally {
            document.getElementById("spinner").style.display = "none";
          }
        }

        function loadBobURLForLink(url){ loadBobURL(url, true); }
        function goBack(){ if(historyIndex>0){ historyIndex--; loadBobURL(historyStack[historyIndex], false); } }
        function goForward(){ if(historyIndex<historyStack.length-1){ historyIndex++; loadBobURL(historyStack[historyIndex], false); } }
        function reloadPage(){ if(historyIndex>=0){ loadBobURL(historyStack[historyIndex], false); } else { loadBobURL(); } }
        document.getElementById("url").addEventListener("keypress", e => { if(e.key==="Enter") loadBobURL(); });
      `;

      // Blobã«å¤‰æ›ã—ã¦æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã
      const blob = new Blob([`
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>ãƒ›ãƒ¼ãƒ </title>
  <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/1/19/Google_Classroom_Logo.svg" />
          <style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
  }

  #app {
    position: relative;
    width: 100%;
    height: 100%;
  }

  #toolbar {
    height: 50px; /* ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®é«˜ã•ã‚’å›ºå®š */
    padding: 10px;
    background: #222;
    color: white;
    display: flex;
    gap: 5px;
    align-items: center;
    box-sizing: border-box;
  }

  #url {
    flex: 1;
    padding: 5px 10px;
    border-radius: 5px;
    border: none;
    font-size: 16px;
  }

  button.toolbar-btn {
    padding: 5px 10px;
    border-radius: 5px;
    border: none;
    background: #4CAF50;
    color: white;
    cursor: pointer;
    font-size: 14px;
  }

  button.toolbar-btn:hover { background: #45a049; }

  #spinner { display: none; margin-left: 10px; }

  #viewer {
    position: absolute;
    top: 50px;   /* ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®é«˜ã•åˆ†ã ã‘ä¸‹ã« */
    left: 0;
    right: 0;
    bottom: 0;
    border: none;
    width: 100%;
    height: calc(100% - 50px); /* å¿µã®ãŸã‚ä¿é™º */
  }
</style>

        </head>
        <body>
          ${appHTML}
          <script>${appScript}<\/script>
        </body>
        </html>
      `], { type: "text/html" });

      const url = URL.createObjectURL(blob);
      const win = window.open(url, "_blank");

      // 2ç§’å¾Œã« Blob URL ã‚’ç ´æ£„
      setTimeout(() => URL.revokeObjectURL(url), 2000);
    }
  </script>
</body>
</html>
