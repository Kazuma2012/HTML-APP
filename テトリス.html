
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>ãƒ†ãƒˆãƒªã‚¹ï¼ˆãƒã‚¤ã‚¯ãƒ©é¢¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä»˜ãï¼‰</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: monospace, sans-serif;
    text-align: center;
    margin: 0;
    padding: 0;
  }

  h1 {
    margin-top: 60px;
    font-size: 3em;
    color: #55ff55;
    text-shadow:
      0 0 5px #2f8f2f,
      0 0 10px #2f8f2f,
      0 0 20px #1f5f1f;
  }

  #menu {
    margin-top: 80px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    width: 240px;
    margin-left: auto;
    margin-right: auto;
  }

  #menu button {
    background-color: #3aaf3a;
    border: 4px solid #2a7a2a;
    border-radius: 12px;
    box-shadow:
      inset 0 0 8px #7fff7f,
      0 6px 0 #1f5f1f;
    font-size: 1.4em;
    color: white;
    cursor: pointer;
    padding: 15px 0;
    transition: background-color 0.3s, box-shadow 0.3s;
    font-weight: bold;
    letter-spacing: 0.05em;
    user-select: none;
  }

  #menu button:hover {
    background-color: #55cc55;
    box-shadow:
      inset 0 0 10px #aaffaa,
      0 8px 0 #2f7f2f;
  }

  #gameContainer {
    display: none;
    margin-top: 30px;
  }

  #scoreDisplay {
    font-size: 2em;
    font-weight: bold;
    margin-bottom: 20px;
    color: #aaffaa;
    text-shadow: 0 0 5px #2a7a2a;
  }

  #gameContainer button {
    background-color: #3aaf3a;
    border: 3px solid #2a7a2a;
    border-radius: 10px;
    box-shadow:
      inset 0 0 6px #7fff7f,
      0 4px 0 #1f5f1f;
    color: white;
    font-weight: bold;
    font-size: 1.1em;
    padding: 10px 20px;
    margin: 5px 10px;
    cursor: pointer;
    transition: background-color 0.3s, box-shadow 0.3s;
  }

  #gameContainer button:hover {
    background-color: #55cc55;
    box-shadow:
      inset 0 0 8px #aaffaa,
      0 6px 0 #2f7f2f;
  }

  canvas {
    background: #000;
    border: 5px solid #2a7a2a;
    display: block;
    margin: 20px auto 40px auto;
    box-shadow: 0 0 20px #3aff3a;
  }

  #settingsPanel, #adminPanel {
    display: none;
    margin-top: 60px;
    color: #aaffaa;
    font-size: 1.2em;
  }

  #settingsPanel h2, #adminPanel h2 {
    font-size: 2em;
    margin-bottom: 30px;
    color: #55ff55;
    text-shadow: 0 0 10px #2a7a2a;
  }

  #settingsPanel label {
    display: block;
    margin: 15px auto;
    max-width: 320px;
    text-align: left;
  }

  #settingsPanel input[type="number"] {
    width: 100%;
    padding: 8px;
    font-size: 1em;
    border-radius: 6px;
    border: 2px solid #3a7a3a;
    background: #222;
    color: #aaffaa;
    box-shadow: inset 0 0 5px #2f8f2f;
  }

  #settingsPanel input[type="checkbox"] {
    transform: scale(1.5);
    margin-right: 10px;
    vertical-align: middle;
  }

  #settingsPanel button, #adminPanel button {
    margin-top: 40px;
    padding: 12px 40px;
    font-size: 1.3em;
    font-weight: bold;
    border-radius: 12px;
    border: none;
    background-color: #3aaf3a;
    box-shadow:
      inset 0 0 8px #7fff7f,
      0 6px 0 #1f5f1f;
    cursor: pointer;
    transition: background-color 0.3s;
  }

  #settingsPanel button:hover, #adminPanel button:hover {
    background-color: #55cc55;
  }
</style>
</head>
<body>

  <h1>ãƒ†ãƒˆãƒªã‚¹</h1>

  <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ -->
  <div id="menu">
    <button id="playBtn">â–¶ ãƒ—ãƒ¬ã‚¤</button>
    <button id="settingsBtn">âš™ è¨­å®š</button>
    <button id="adminBtn">ğŸ”§ ç®¡ç†ç”»é¢</button>
  </div>

  <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
  <div id="gameContainer">
    <p id="scoreDisplay">ã‚¹ã‚³ã‚¢: <span id="score">0</span></p>
    <button id="startStopBtn">â–¶ ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    <button id="restartBtn">æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</button>
    <button id="backToMenuBtn">â¬… ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸æˆ»ã‚‹</button>
    <canvas id="game" width="200" height="400"></canvas>
  </div>

  <!-- è¨­å®šç”»é¢ -->
  <div id="settingsPanel">
    <h2>è¨­å®š</h2>
    <label>
      è½ä¸‹é€Ÿåº¦ï¼ˆãƒŸãƒªç§’ 10ã€œ5000ï¼‰:
      <input type="number" id="speedInput" min="10" max="5000" value="1000" />
    </label>

    <label>
      <input type="checkbox" id="holdPreventToggle" checked />
      é•·æŠ¼ã—é˜²æ­¢ã‚’æœ‰åŠ¹ã«ã™ã‚‹
    </label>

    <button id="closeSettingsBtn">é–‰ã˜ã‚‹</button>
  </div>

  <!-- ç®¡ç†ç”»é¢ -->
  <div id="adminPanel">
    <h2>ç®¡ç†è€…ç”»é¢</h2>
    <button id="resetScoreBtn">ã‚¹ã‚³ã‚¢ãƒªã‚»ãƒƒãƒˆ</button>
    <button id="closeAdminBtn">é–‰ã˜ã‚‹</button>
  </div>

<script>
  // DOMè¦ç´ å–å¾—
  const menu = document.getElementById('menu');
  const gameContainer = document.getElementById('gameContainer');
  const settingsPanel = document.getElementById('settingsPanel');
  const adminPanel = document.getElementById('adminPanel');

  const playBtn = document.getElementById('playBtn');
  const settingsBtn = document.getElementById('settingsBtn');
  const adminBtn = document.getElementById('adminBtn');

  const backToMenuBtn = document.getElementById('backToMenuBtn');
  const closeSettingsBtn = document.getElementById('closeSettingsBtn');
  const closeAdminBtn = document.getElementById('closeAdminBtn');

  // ç”»é¢åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
  function showMenu(){
    menu.style.display = 'flex';
    gameContainer.style.display = 'none';
    settingsPanel.style.display = 'none';
    adminPanel.style.display = 'none';
  }
  function showGame(){
    menu.style.display = 'none';
    gameContainer.style.display = 'block';
    settingsPanel.style.display = 'none';
    adminPanel.style.display = 'none';
  }
  function showSettings(){
    menu.style.display = 'none';
    gameContainer.style.display = 'none';
    settingsPanel.style.display = 'block';
    adminPanel.style.display = 'none';
  }
  function showAdmin(){
    menu.style.display = 'none';
    gameContainer.style.display = 'none';
    settingsPanel.style.display = 'none';
    adminPanel.style.display = 'block';
  }

  // åˆæœŸè¡¨ç¤ºã¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼
  showMenu();

  // ãƒœã‚¿ãƒ³æŠ¼ä¸‹ã‚¤ãƒ™ãƒ³ãƒˆ
  playBtn.onclick = () => { showGame(); };
  settingsBtn.onclick = () => { showSettings(); };
  adminBtn.onclick = () => {
    const input = prompt('ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    if(input != null){
      const normalized = input.replace(/[ï¼-ï¼™]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0));
      if(normalized === '190427'){
        showAdmin();
      } else {
        alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™');
      }
    }
  };
  backToMenuBtn.onclick = () => { stopGame(); showMenu(); };
  closeSettingsBtn.onclick = () => { showMenu(); };
  closeAdminBtn.onclick = () => { showMenu(); };

  // ã‚²ãƒ¼ãƒ å¤‰æ•°
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  const ROWS = 20;
  const COLS = 10;
  const BLOCK_SIZE = 20;

  // è‰²ï¼ˆãƒã‚¤ã‚¯ãƒ©é¢¨ã®ã‚°ãƒªãƒ¼ãƒ³ç³»ï¼‰
  const COLORS = [
    null,
    '#55ff55', // I
    '#33cc33', // J
    '#22aa22', // L
    '#44dd44', // O
    '#33bb33', // S
    '#55ee55', // T
    '#22cc22'  // Z
  ];

  // ãƒ†ãƒˆãƒªã‚¹ã®å½¢ï¼ˆ7ç¨®ï¼‰
  const SHAPES = [
    [],
    [[1,1,1,1]],            // I
    [[2,0,0],[2,2,2]],      // J
    [[0,0,3],[3,3,3]],      // L
    [[4,4],[4,4]],          // O
    [[0,5,5],[5,5,0]],      // S
    [[0,6,0],[6,6,6]],      // T
    [[7,7,0],[0,7,7]]       // Z
  ];

  // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
  let board = [];
  let currentPiece = null;
  let currentX = 0;
  let currentY = 0;
  let score = 0;
  let dropInterval = 1000;
  let dropTimerId = null;
  let gameRunning = false;

  // è¨­å®šUIè¦ç´ 
  const speedInput = document.getElementById('speedInput');
  const holdPreventToggle = document.getElementById('holdPreventToggle');

  // ã‚¹ã‚³ã‚¢è¡¨ç¤ºè¦ç´ 
  const scoreSpan = document.getElementById('score');

  // é–‹å§‹ãƒ»åœæ­¢ãƒ»ãƒªã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³
  const startStopBtn = document.getElementById('startStopBtn');
  const restartBtn = document.getElementById('restartBtn');

  // åˆæœŸåŒ–é–¢æ•°
  function initBoard(){
    board = [];
    for(let r=0; r<ROWS; r++){
      const row = new Array(COLS).fill(0);
      board.push(row);
    }
  }

  // æ–°ã—ã„ãƒ”ãƒ¼ã‚¹ç”Ÿæˆ
  function createPiece(){
    const typeId = Math.floor(Math.random()*7)+1;
    const shape = SHAPES[typeId];
    return {typeId, shape};
  }

  // æç”»é–¢æ•°
  function drawBlock(x, y, colorId){
    if(colorId == null || colorId === 0) return;
    ctx.fillStyle = COLORS[colorId];
    ctx.shadowColor = COLORS[colorId];
    ctx.shadowBlur = 10;
    ctx.fillRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
    ctx.shadowBlur = 0;
    ctx.strokeStyle = '#004400';
    ctx.lineWidth = 2;
    ctx.strokeRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
  }

  // ç›¤é¢æç”»
  function drawBoard(){
    ctx.clearRect(0,0,canvas.width, canvas.height);
    for(let r=0; r<ROWS; r++){
      for(let c=0; c<COLS; c++){
        drawBlock(c, r, board[r][c]);
      }
    }
  }

  // ãƒ”ãƒ¼ã‚¹æç”»
  function drawPiece(piece, posX, posY){
    piece.shape.forEach((row, y) => {
      row.forEach((val, x) => {
        if(val !== 0){
          drawBlock(posX + x, posY + y, piece.typeId);
        }
      });
    });
  }

  // è¡çªåˆ¤å®š
  function collide(piece, posX, posY){
    for(let y=0; y<piece.shape.length; y++){
      for(let x=0; x<piece.shape[y].length; x++){
        if(piece.shape[y][x]){
          const newX = posX + x;
          const newY = posY + y;
          if(newX < 0 || newX >= COLS || newY >= ROWS) return true;
          if(newY >= 0 && board[newY][newX]) return true;
        }
      }
    }
    return false;
  }

  // ãƒ”ãƒ¼ã‚¹ã‚’ç›¤é¢ã«å›ºå®š
  function fixPiece(piece, posX, posY){
    piece.shape.forEach((row, y) => {
      row.forEach((val, x) => {
        if(val){
          board[posY + y][posX + x] = piece.typeId;
        }
      });
    });
  }

  // ãƒ©ã‚¤ãƒ³æ¶ˆå»åˆ¤å®š
  function clearLines(){
    let linesCleared = 0;
    outer: for(let y=ROWS-1; y>=0; y--){
      for(let x=0; x<COLS; x++){
        if(board[y][x] === 0){
          continue outer;
        }
      }
      // 1è¡Œæ¶ˆã™
      board.splice(y,1);
      board.unshift(new Array(COLS).fill(0));
      linesCleared++;
      y++; // å†ãƒã‚§ãƒƒã‚¯
    }
    return linesCleared;
  }

  // ãƒ”ãƒ¼ã‚¹å›è»¢
  function rotate(piece){
    const newShape = [];
    const h = piece.shape.length;
    const w = piece.shape[0].length;
    for(let x=0; x<w; x++){
      const newRow = [];
      for(let y=h-1; y>=0; y--){
        newRow.push(piece.shape[y][x]);
      }
      newShape.push(newRow);
    }
    piece.shape = newShape;
  }

  // ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ï¼ˆè½ä¸‹ï¼‰
  function gameLoop(){
    if(!gameRunning) return;
    if(!movePiece(currentPiece, currentX, currentY + 1)){
      fixPiece(currentPiece, currentX, currentY);
      const lines = clearLines();
      if(lines > 0){
        score += lines * 100;
        scoreSpan.textContent = score;
      }
      currentPiece = createPiece();
      currentX = Math.floor(COLS/2) - Math.floor(currentPiece.shape[0].length/2);
      currentY = 0;
      if(collide(currentPiece, currentX, currentY)){
        alert('ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼ã‚¹ã‚³ã‚¢: ' + score);
        stopGame();
        return;
      }
    }
    drawBoard();
    drawPiece(currentPiece, currentX, currentY);
  }

  // ãƒ”ãƒ¼ã‚¹ç§»å‹•
  function movePiece(piece, newX, newY){
    if(collide(piece, newX, newY)) return false;
    currentX = newX;
    currentY = newY;
    drawBoard();
    drawPiece(piece, currentX, currentY);
    return true;
  }

  // ã‚²ãƒ¼ãƒ é–‹å§‹
  function startGame(){
    if(gameRunning) return;
    initBoard();
    currentPiece = createPiece();
    currentX = Math.floor(COLS/2) - Math.floor(currentPiece.shape[0].length/2);
    currentY = 0;
    score = 0;
    scoreSpan.textContent = score;
    gameRunning = true;
    startStopBtn.textContent = 'â¸ ã‚²ãƒ¼ãƒ ä¸€æ™‚åœæ­¢';
    drawBoard();
    drawPiece(currentPiece, currentX, currentY);
    dropTimerId = setInterval(gameLoop, dropInterval);
  }

  // ã‚²ãƒ¼ãƒ åœæ­¢
  function stopGame(){
    gameRunning = false;
    clearInterval(dropTimerId);
    startStopBtn.textContent = 'â–¶ ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ';
  }

  // ã‚²ãƒ¼ãƒ ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ
  function restartGame(){
    stopGame();
    startGame();
  }

  // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
  startStopBtn.onclick = () => {
    if(gameRunning){
      stopGame();
    } else {
      startGame();
    }
  };

  restartBtn.onclick = () => {
    restartGame();
  };

  // è¨­å®šåæ˜ 
  speedInput.onchange = () => {
    let val = parseInt(speedInput.value);
    if(isNaN(val) || val < 10) val = 10;
    else if(val > 5000) val = 5000;
    dropInterval = val;
    if(gameRunning){
      clearInterval(dropTimerId);
      dropTimerId = setInterval(gameLoop, dropInterval);
    }
    speedInput.value = val;
  };

  // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ
  document.addEventListener('keydown', e => {
    if(!gameRunning) return;
    switch(e.key){
      case 'ArrowLeft':
        movePiece(currentPiece, currentX - 1, currentY);
        break;
      case 'ArrowRight':
        movePiece(currentPiece, currentX + 1, currentY);
        break;
      case 'ArrowDown':
        movePiece(currentPiece, currentX, currentY + 1);
        break;
      case 'ArrowUp':
        // å›è»¢
        rotate(currentPiece);
        if(collide(currentPiece, currentX, currentY)){
          // ã¶ã¤ã‹ã£ã¦ãŸã‚‰æˆ»ã™
          for(let i=0; i<3; i++) rotate(currentPiece);
        }
        drawBoard();
        drawPiece(currentPiece, currentX, currentY);
        break;
      case ' ':
        // ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—
        while(movePiece(currentPiece, currentX, currentY + 1)){}
        gameLoop();
        break;
    }
  });

  // ç®¡ç†ç”»é¢ ã‚¹ã‚³ã‚¢ãƒªã‚»ãƒƒãƒˆ
  document.getElementById('resetScoreBtn').onclick = () => {
    score = 0;
    scoreSpan.textContent = score;
    alert('ã‚¹ã‚³ã‚¢ãƒªã‚»ãƒƒãƒˆã—ãŸã‚ˆï¼');
  };

</script>

</body>
</html>
