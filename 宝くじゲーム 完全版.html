
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>å®ãã˜ã‚²ãƒ¼ãƒ  å®Œå…¨ç‰ˆ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; text-align: center; }
    button { margin: 3px; padding: 10px 20px; font-size: 18px; }
    .ticket { display: inline-block; border: 1px solid #ccc; margin: 3px; padding: 5px; width: 60px; text-align: center; }
    .hit { background-color: gold; }
    #summary { margin-top: 20px; border: 1px solid #ccc; padding: 10px; background: #f9f9f9; }
    .positive { color: green; }
    .negative { color: red; }

    /* ğŸ“Œ ä¸­å¤®ã«è¡¨ç¤ºï¼‹å¤§ãã‚ã‚¹ã‚¿ã‚¤ãƒ« */
    #keypad, #startNum {
      display: block;
      margin: 20px auto;
      text-align: center;
    }

    #startNum {
      padding: 15px;
      font-size: 24px;
      width: 250px;
      border: 2px solid #007bff;
      border-radius: 8px;
      text-align: center;
    }

    #ticketArea {
      margin-top: 20px;
    }

    canvas {
      margin: 20px auto;
      display: block;
    }
  </style>
</head>
<body>
  <h1>ğŸ¯ å®ãã˜ã‚²ãƒ¼ãƒ  å®Œå…¨ç‰ˆ</h1>

  <!-- ãƒ¢ãƒ¼ãƒ‰é¸æŠ -->
  <div style="margin-top: 10px;">
    <label><input type="radio" name="mode" value="é€£ç•ª" checked /> é€£ç•ª</label>
    <label><input type="radio" name="mode" value="ãƒãƒ©" /> ãƒãƒ©</label>
  </div>

  <!-- é€£ç•ªç•ªå·å…¥åŠ› -->
  <input type="number" id="startNum" placeholder="ï¼ˆé€£ç•ªç”¨ï¼‰é–‹å§‹ç•ªå·" />

  <!-- è³¼å…¥æšæ•° -->
  <div id="keypad">
    <p>ğŸ§¾ è³¼å…¥æšæ•°ã‚’é¸ã‚“ã§ã­ï¼š</p>
    <div>
      <button onclick="setCount(1)">1</button>
      <button onclick="setCount(2)">2</button>
      <button onclick="setCount(3)">3</button>
    </div>
    <div>
      <button onclick="setCount(4)">4</button>
      <button onclick="setCount(5)">5</button>
      <button onclick="setCount(10)">10</button>
    </div>
    <div>
      <button onclick="setCount(50)">50</button>
      <button onclick="setCount(100)">100</button>
    </div>
    <p>âœ… é¸æŠä¸­ï¼š<span id="selectedCount">1</span>æš</p>
  </div>

  <!-- å®Ÿè¡Œãƒœã‚¿ãƒ³ -->
  <button onclick="buyTickets()">ãã˜ã‚’è²·ã†ï¼</button>
  <button onclick="draw()">æŠ½é¸ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>

  <!-- çµæœè¡¨ç¤º -->
  <div id="ticketArea"></div>
  <div id="summary"></div>
  <canvas id="resultChart" style="max-width: 400px;"></canvas>

  <script>
    let tickets = [];
    let winNumber = "";
    let selectedCount = 1;
    let chart = null;

    function pad4(num) {
      return num.toString().padStart(4, '0');
    }

    function setCount(n) {
      selectedCount = n;
      document.getElementById("selectedCount").textContent = n;
    }

    function getSelectedMode() {
      return document.querySelector('input[name="mode"]:checked').value;
    }

    function generateRandomTickets(count) {
      const set = new Set();
      while (set.size < count) {
        const rand = Math.floor(Math.random() * 10000);
        set.add(pad4(rand));
      }
      return Array.from(set);
    }

    function buyTickets() {
      const mode = getSelectedMode();
      const count = selectedCount;

      if (mode === "é€£ç•ª") {
        let start = parseInt(document.getElementById('startNum').value, 10);
        if (isNaN(start) || start < 0 || start > 9999) {
          alert("é€£ç•ªãƒ¢ãƒ¼ãƒ‰ã§ã¯0ã€œ9999ã®4æ¡ç•ªå·ã‚’å…¥åŠ›ã—ã¦ã­ï¼");
          return;
        }
        tickets = [];
        for (let i = 0; i < count; i++) {
          let num = (start + i) % 10000;
          tickets.push(pad4(num));
        }
      } else if (mode === "ãƒãƒ©") {
        tickets = generateRandomTickets(count);
      }

      document.getElementById('summary').innerHTML = "";
      document.getElementById('resultChart').style.display = "none";
      if (chart) chart.destroy();
      displayTickets();
    }

    function draw() {
      winNumber = pad4(Math.floor(Math.random() * 10000));
      let rankCount = { "1ç­‰": 0, "2ç­‰": 0, "3ç­‰": 0, "4ç­‰": 0, "ãƒã‚ºãƒ¬": 0 };
      let totalWin = 0;

      tickets.forEach((ticket, index) => {
        let rank = getRank(ticket, winNumber);
        if (rank !== "ãƒã‚ºãƒ¬") {
          document.getElementById('ticketArea').children[index].classList.add("hit");
        }
        rankCount[rank]++;
        totalWin += getPrize(rank);
      });

      const cost = tickets.length * 300;
      const profit = totalWin - cost;
      const profitClass = profit >= 0 ? "positive" : "negative";

      let summary = `
        <h3>ğŸ¯ æŠ½é¸ç•ªå·ï¼š${winNumber}</h3>
        <p>ğŸŸï¸ è³¼å…¥æšæ•°ï¼š${tickets.length}æšï¼ˆ300å†† Ã— ${tickets.length} = ${cost.toLocaleString()}å††ï¼‰</p>
        <p>ğŸ’° åˆè¨ˆå½“é¸é‡‘é¡ï¼š${totalWin.toLocaleString()}å††</p>
        <p class="${profitClass}">ğŸ“ˆ åæ”¯ï¼š${profit >= 0 ? '+' : ''}${profit.toLocaleString()}å††</p>
        <h4>ğŸ† å½“é¸å†…è¨³ï¼š</h4>
        <ul>
          <li>1ç­‰ï¼š${rankCount["1ç­‰"]}æœ¬ï¼ˆ${(rankCount["1ç­‰"] * 1000000).toLocaleString()}å††ï¼‰</li>
          <li>2ç­‰ï¼š${rankCount["2ç­‰"]}æœ¬ï¼ˆ${(rankCount["2ç­‰"] * 100000).toLocaleString()}å††ï¼‰</li>
          <li>3ç­‰ï¼š${rankCount["3ç­‰"]}æœ¬ï¼ˆ${(rankCount["3ç­‰"] * 10000).toLocaleString()}å††ï¼‰</li>
          <li>4ç­‰ï¼š${rankCount["4ç­‰"]}æœ¬ï¼ˆ${(rankCount["4ç­‰"] * 1000).toLocaleString()}å††ï¼‰</li>
          <li>ãƒã‚ºãƒ¬ï¼š${rankCount["ãƒã‚ºãƒ¬"]}æœ¬</li>
        </ul>
      `;
      document.getElementById('summary').innerHTML = `<div id="summary">${summary}</div>`;
      drawChart(rankCount);
    }

    function getPrize(rank) {
      switch (rank) {
        case "1ç­‰": return 1000000;
        case "2ç­‰": return 100000;
        case "3ç­‰": return 10000;
        case "4ç­‰": return 1000;
        default: return 0;
      }
    }

    function getRank(ticket, win) {
      if (ticket === win) return "1ç­‰";
      if (ticket.slice(1) === win.slice(1)) return "2ç­‰";
      if (ticket.slice(2) === win.slice(2)) return "3ç­‰";
      if (ticket.slice(3) === win.slice(3)) return "4ç­‰";
      return "ãƒã‚ºãƒ¬";
    }

    function displayTickets() {
      const area = document.getElementById('ticketArea');
      area.innerHTML = "";
      tickets.forEach(t => {
        const div = document.createElement("div");
        div.className = "ticket";
        div.textContent = t;
        area.appendChild(div);
      });
    }

    function drawChart(rankCount) {
      const ctx = document.getElementById('resultChart');
      document.getElementById('resultChart').style.display = "block";

      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ["1ç­‰", "2ç­‰", "3ç­‰", "4ç­‰", "ãƒã‚ºãƒ¬"],
          datasets: [{
            label: 'å½“é¸æ•°',
            data: [
              rankCount["1ç­‰"],
              rankCount["2ç­‰"],
              rankCount["3ç­‰"],
              rankCount["4ç­‰"],
              rankCount["ãƒã‚ºãƒ¬"]
            ],
            backgroundColor: ['#ff5959', '#ffa500', '#87ceeb', '#90ee90', '#ccc']
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }
  </script>
</body>
</html>
