<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¢åµæ¨ç†ã‚²ãƒ¼ãƒ ï¼šå°ã•ãªç”ºã®æ®ºäººäº‹ä»¶</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&display=swap');
        body {
            font-family: 'Noto Serif JP', serif;
        }
        .choice-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="bg-slate-800 text-white flex items-center justify-center min-h-screen p-4">

    <div id="game-container" class="w-full max-w-3xl bg-slate-900 rounded-2xl shadow-2xl overflow-hidden border-4 border-slate-700">
        <!-- ç”»åƒè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="image-container" class="bg-slate-800 p-4 border-b-4 border-slate-700 flex justify-center items-center min-h-[250px] md:min-h-[300px]">
            <!-- SVGç”»åƒãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
        </div>

        <div class="p-6 md:p-8">
            <!-- ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div id="text-container" class="mb-6 min-h-[100px] text-lg leading-relaxed">
                <p>èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>

            <!-- é¸æŠè‚¢ã‚¨ãƒªã‚¢ -->
            <div id="choices-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- é¸æŠè‚¢ãƒœã‚¿ãƒ³ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>
        </div>
        
        <!-- è¨¼æ‹ å“ãƒªã‚¹ãƒˆã‚¨ãƒªã‚¢ -->
        <div id="inventory-container" class="bg-slate-950 p-4 border-t-4 border-slate-700">
            <h3 class="font-bold text-amber-400 mb-2 text-center text-sm tracking-widest">å…¥æ‰‹ã—ãŸè¨¼æ‹ </h3>
            <ul id="inventory-list" class="flex flex-wrap gap-x-4 gap-y-2 justify-center items-center text-slate-300">
                <li id="no-evidence">ã¾ã è¨¼æ‹ ã¯ãªã„...</li>
            </ul>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const imageContainer = document.getElementById('image-container');
            const textContainer = document.getElementById('text-container');
            const choicesContainer = document.getElementById('choices-container');
            const inventoryList = document.getElementById('inventory-list');
            const noEvidence = document.getElementById('no-evidence');

            let inventory = new Set();

            // SVGç”»åƒã®å®šç¾©
            const images = {
                crime_scene: `
                    <svg viewBox="0 0 200 100" class="w-full h-auto max-h-64">
                        <rect width="200" height="100" fill="#334155"/>
                        <path d="M 80 70 C 70 50, 90 40, 100 45 S 130 55, 120 75 Z" fill="none" stroke="#f87171" stroke-width="1.5" stroke-dasharray="2 2"/>
                        <circle cx="110" cy="55" r="3" fill="#ef4444"/>
                        <text x="115" y="58" fill="#fde047" font-size="6">A</text>
                        <rect x="40" y="60" width="15" height="8" fill="#94a3b8" transform="rotate(-15 40 60)"/>
                        <text x="45" y="72" fill="#fde047" font-size="6">B</text>
                        <circle cx="150" cy="80" r="4" fill="#64748b"/>
                        <text x="155" y="83" fill="#fde047" font-size="6">C</text>
                        <text x="10" y="15" fill="#e2e8f0" font-size="8" font-weight="bold">äº‹ä»¶ç¾å ´</text>
                    </svg>`,
                suspect_a: `
                    <svg viewBox="0 0 100 100" class="w-48 h-48">
                        <rect width="100" height="100" fill="#1e293b"/>
                        <circle cx="50" cy="30" r="15" fill="#94a3b8"/>
                        <path d="M 30 50 C 30 70, 70 70, 70 50 V 45 H 30 Z" fill="#94a3b8"/>
                        <rect x="30" y="70" width="40" height="30" fill="#94a3b8"/>
                        <text x="15" y="95" fill="#e2e8f0" font-size="8">å®¹ç–‘è€…A: ç”°ä¸­</text>
                    </svg>`,
                suspect_b: `
                    <svg viewBox="0 0 100 100" class="w-48 h-48">
                        <rect width="100" height="100" fill="#1e293b"/>
                        <circle cx="50" cy="30" r="15" fill="#94a3b8"/>
                        <path d="M 40 45 L 60 45 L 65 90 L 35 90 Z" fill="#94a3b8"/>
                        <text x="15" y="95" fill="#e2e8f0" font-size="8">å®¹ç–‘è€…B: éˆ´æœ¨</text>
                    </svg>`,
                evidence_knife: `
                    <svg viewBox="0 0 100 100" class="w-48 h-48">
                        <rect width="100" height="100" fill="#1e293b"/>
                        <path d="M 30 50 L 70 10 L 75 15 L 35 55 Z" fill="#e2e8f0"/>
                        <rect x="20" y="50" width="15" height="10" fill="#ca8a04"/>
                        <circle cx="35" cy="55" r="2" fill="#ef4444"/>
                        <text x="25" y="80" fill="#e2e8f0" font-size="8">è¨¼æ‹ ï¼šè¡€ç—•ã®ä»˜ã„ãŸãƒŠã‚¤ãƒ•</text>
                    </svg>`,
                evidence_letter: `
                    <svg viewBox="0 0 100 100" class="w-48 h-48">
                        <rect width="100" height="100" fill="#1e293b"/>
                        <rect x="20" y="20" width="60" height="40" fill="#f1f5f9"/>
                        <line x1="25" y1="30" x2="75" y2="30" stroke="#64748b" stroke-width="2"/>
                        <line x1="25" y1="40" x2="65" y2="40" stroke="#64748b" stroke-width="2"/>
                        <line x1="25" y1="50" x2="70" y2="50" stroke="#ef4444" stroke-width="2"/>
                        <text x="30" y="80" fill="#e2e8f0" font-size="8">è¨¼æ‹ ï¼šè„…è¿«çŠ¶</text>
                    </svg>`,
                interrogation_room: `
                    <svg viewBox="0 0 200 100" class="w-full h-auto max-h-64">
                        <rect width="200" height="100" fill="#334155"/>
                        <rect x="60" y="40" width="80" height="30" fill="#475569"/>
                        <rect x="70" y="65" width="20" height="20" fill="#1e293b"/>
                        <rect x="110" y="65" width="20" height="20" fill="#1e293b"/>
                        <line x1="0" y1="90" x2="200" y2="90" stroke="#1e293b" stroke-width="5"/>
                        <text x="10" y="15" fill="#e2e8f0" font-size="8" font-weight="bold">å°‹å•å®¤</text>
                    </svg>`,
                ending_success: `
                    <svg viewBox="0 0 100 100" class="w-48 h-48">
                        <rect width="100" height="100" fill="#15803d"/>
                        <path d="M 20 50 L 45 75 L 80 30" fill="none" stroke="#fde047" stroke-width="8" stroke-linecap="round"/>
                        <text x="15" y="90" fill="white" font-size="10">äº‹ä»¶è§£æ±º</text>
                    </svg>`,
                ending_fail: `
                    <svg viewBox="0 0 100 100" class="w-48 h-48">
                        <rect width="100" height="100" fill="#be123c"/>
                        <line x1="20" y1="20" x2="80" y2="80" stroke="white" stroke-width="8" stroke-linecap="round"/>
                        <line x1="80" y1="20" x2="20" y2="80" stroke="white" stroke-width="8" stroke-linecap="round"/>
                        <text x="15" y="90" fill="white" font-size="10">çŠ¯äººã‚’å–ã‚Šé€ƒãŒã—ãŸ</text>
                    </svg>`
            };
            
            // ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿
            const story = {
                start: {
                    text: "é™ã‹ãªæ¸¯ç”ºã§ã€è³‡ç”£å®¶ã®å±±ä¸‹æ°ãŒæ®ºå®³ã•ã‚ŒãŸã€‚ã‚ãªãŸã¯æ‹…å½“åˆ‘äº‹ã¨ã—ã¦ã€ã“ã®äº‹ä»¶ã®æœæŸ»ã‚’å‘½ã˜ã‚‰ã‚ŒãŸã€‚ã¾ãšã¯ã©ã“ã‹ã‚‰èª¿ã¹ã‚‹ï¼Ÿ",
                    image: "crime_scene",
                    choices: [
                        { text: "äº‹ä»¶ç¾å ´ã‚’è©³ã—ãèª¿ã¹ã‚‹", next: "scene_examine" },
                        { text: "é–¢ä¿‚è€…ã¸ã®èãè¾¼ã¿ã‚’é–‹å§‹ã™ã‚‹", next: "scene_interrogate_start" }
                    ]
                },
                scene_examine: {
                    text: "ç¾å ´ã¯å±±ä¸‹æ°ã®æ›¸æ–ã ã€‚è’ã‚‰ã•ã‚ŒãŸæ§˜å­ã¯ãªã„ãŒã€åºŠã«è¡€ç—•ã¨å€’ã‚ŒãŸãƒ©ãƒ³ãƒ—ãŒã‚ã‚‹ã€‚æœºã®ä¸Šã«ã¯ä½•ã‹æ‰‹ç´™ã®ã‚ˆã†ãªã‚‚ã®ãŒè¦‹ãˆã‚‹ã€‚",
                    image: "crime_scene",
                    choices: [
                        { text: "åºŠã®è¡€ç—•ã‚’èª¿ã¹ã‚‹", next: "scene_examine_blood" },
                        { text: "æœºã®æ‰‹ç´™ã‚’èª¿ã¹ã‚‹", next: "scene_examine_letter" }
                    ]
                },
                scene_examine_blood: {
                    text: "è¡€ç—•ã®ãã°ã«ã€å°ã•ãªãƒ•ãƒ«ãƒ¼ãƒ„ãƒŠã‚¤ãƒ•ãŒè½ã¡ã¦ã„ã‚‹ã€‚æŸ„ã«ã¯æ‹­ãå–ã‚‰ã‚ŒãŸã‚ˆã†ãªè·¡ãŒã‚ã‚‹ãŒã€å¾®ã‹ã«è¡€ãŒä»˜ç€ã—ã¦ã„ã‚‹ã‚ˆã†ã ã€‚é‡è¦ãªè¨¼æ‹ ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚",
                    image: "evidence_knife",
                    onEnter: () => addInventory("è¡€ã®ä»˜ã„ãŸãƒŠã‚¤ãƒ•"),
                    choices: [
                        { text: "æœºã®æ‰‹ç´™ã‚‚èª¿ã¹ã‚‹", next: "scene_examine_letter" },
                        { text: "ç¾å ´ã®èª¿æŸ»ã‚’çµ‚ãˆã‚‹", next: "scene_interrogate_start" }
                    ]
                },
                scene_examine_letter: {
                    text: "æœºã®ä¸Šã«ã¯ã€äº‹æ¥­ã®å¤±æ•—ã‚’ãªã˜ã‚‹è„…è¿«çŠ¶ãŒç½®ã‹ã‚Œã¦ã„ãŸã€‚ã€ãŠå‰ã®ã›ã„ã§å…¨ã¦ã‚’å¤±ã£ãŸã€‚å¿…ãšå ±ã„ã‚’å—ã‘ã•ã›ã‚‹ã€ã¨æ›¸ã‹ã‚Œã¦ã„ã‚‹ã€‚å·®å‡ºäººã®åå‰ã¯ãªã„ã€‚",
                    image: "evidence_letter",
                    onEnter: () => addInventory("è„…è¿«çŠ¶"),
                    choices: [
                        { text: "åºŠã®è¡€ç—•ã‚‚èª¿ã¹ã‚‹", next: "scene_examine_blood" },
                        { text: "ç¾å ´ã®èª¿æŸ»ã‚’çµ‚ãˆã‚‹", next: "scene_interrogate_start" }
                    ]
                },
                scene_interrogate_start: {
                    text: "æœæŸ»ç·šä¸Šã«2äººã®å®¹ç–‘è€…ãŒæµ®ã‹ã³ä¸ŠãŒã£ãŸã€‚è¢«å®³è€…ã®ãƒ“ã‚¸ãƒã‚¹ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã§ã‚ã‚‹ç”°ä¸­ã¨ã€è¢«å®³è€…ã«è§£é›‡ã•ã‚ŒãŸå…ƒç§˜æ›¸ã®éˆ´æœ¨ã ã€‚ã©ã¡ã‚‰ã‹ã‚‰è©±ã‚’èãï¼Ÿ",
                    image: "interrogation_room",
                    choices: [
                        { text: "ãƒ“ã‚¸ãƒã‚¹ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã®ç”°ä¸­ã‚’å°‹å•ã™ã‚‹", next: "interrogate_tanaka_1" },
                        { text: "å…ƒç§˜æ›¸ã®éˆ´æœ¨ã‚’å°‹å•ã™ã‚‹", next: "interrogate_suzuki_1" }
                    ]
                },
                interrogate_tanaka_1: {
                    text: "ç”°ä¸­ã¯è½ã¡ç€ã„ãŸæ§˜å­ã§å°‹å•ã«å¿œã˜ãŸã€‚ã€Œå±±ä¸‹ã•ã‚“ã¨ã¯é•·å¹´ã®ä»˜ãåˆã„ã§ã—ãŸã€‚äº‹æ¥­ã¯é †èª¿ã§ã—ãŸã—ã€æ®ºã™å‹•æ©Ÿãªã‚“ã¦ã‚ã‚Šã¾ã›ã‚“ã‚ˆã€ã¨å½¼ã¯è¨€ã†ã€‚",
                    image: "suspect_a",
                    choices: [
                        { text: "ï¼ˆè„…è¿«çŠ¶ã‚’æŒã£ã¦ã„ã‚‹å ´åˆï¼‰ã“ã®æ‰‹ç´™ã«è¦‹è¦šãˆã¯ï¼Ÿ", next: "interrogate_tanaka_2", condition: () => inventory.has("è„…è¿«çŠ¶") },
                        { text: "äº‹ä»¶å½“å¤œã®ã‚¢ãƒªãƒã‚¤ã‚’èã", next: "interrogate_tanaka_3" },
                        { text: "éˆ´æœ¨ã«ã¤ã„ã¦å°‹ã­ã‚‹", next: "interrogate_tanaka_4" },
                        { text: "å°‹å•ã‚’çµ‚ãˆã‚‹", next: "scene_interrogate_start_after_tanaka" }
                    ]
                },
                 interrogate_tanaka_2: {
                    text: "è„…è¿«çŠ¶ã‚’è¦‹ã›ã‚‹ã¨ã€ç”°ä¸­ã¯é¡”ã‚’ã—ã‹ã‚ãŸã€‚ã€Œã“ã‚Œã¯...ã²ã©ã„ã€‚ã§ã™ãŒã€ç§ã®ç­†è·¡ã§ã¯ãªã„ã€‚ãŠãã‚‰ãã€å½¼ã«æ¨ã¿ã‚’æŒã¤èª°ã‹ã®ä»•æ¥­ã§ã—ã‚‡ã†ã€‚ä¾‹ãˆã°ã€è§£é›‡ã•ã‚ŒãŸéˆ´æœ¨ã•ã‚“ã¨ã‹...ã€",
                    image: "suspect_a",
                    onEnter: () => addInventory("ç”°ä¸­ã¯éˆ´æœ¨ã‚’ç–‘ã£ã¦ã„ã‚‹"),
                    choices: [
                        { text: "äº‹ä»¶å½“å¤œã®ã‚¢ãƒªãƒã‚¤ã‚’èã", next: "interrogate_tanaka_3" },
                        { text: "å°‹å•ã‚’çµ‚ãˆã‚‹", next: "scene_interrogate_start_after_tanaka" }
                    ]
                },
                interrogate_tanaka_3: {
                    text: "ã€Œäº‹ä»¶ãŒã‚ã£ãŸã¨ã•ã‚Œã‚‹å¤œã¯ã€ãšã£ã¨è‡ªå®…ã§ä»•äº‹ã‚’ã—ã¦ã„ã¾ã—ãŸã€‚ä¸€äººã ã£ãŸã®ã§è¨¼æ˜ã¯ã§ãã¾ã›ã‚“ãŒã€ã¨ç”°ä¸­ã¯ç­”ãˆãŸã€‚å®Œç’§ãªã‚¢ãƒªãƒã‚¤ã¯ãªã„ã‚ˆã†ã ã€‚",
                    image: "suspect_a",
                    onEnter: () => addInventory("ç”°ä¸­ã®ã‚¢ãƒªãƒã‚¤ã¯ä¸ç¢ºã‹"),
                    choices: [
                        { text: "éˆ´æœ¨ã«ã¤ã„ã¦å°‹ã­ã‚‹", next: "interrogate_tanaka_4" },
                        { text: "å°‹å•ã‚’çµ‚ãˆã‚‹", next: "scene_interrogate_start_after_tanaka" }
                    ]
                },
                interrogate_tanaka_4: {
                    text: "ã€Œéˆ´æœ¨ã•ã‚“ã¯å„ªç§€ã§ã—ãŸãŒã€ä¼šç¤¾ã®é‡‘ã‚’ä½¿ã„è¾¼ã‚“ã§ã„ã‚‹ç–‘æƒ‘ãŒã‚ã‚Šã€å±±ä¸‹ã•ã‚“ãŒè§£é›‡ã—ãŸã‚“ã§ã™ã€‚å½¼å¥³ã¯ç›¸å½“æ¨ã‚“ã§ã„ãŸã¯ãšã§ã™ã‚ˆã€",
                    image: "suspect_a",
                    choices: [
                        { text: "å°‹å•ã‚’çµ‚ãˆã‚‹", next: "scene_interrogate_start_after_tanaka" }
                    ]
                },
                scene_interrogate_start_after_tanaka: {
                    text: "ç”°ä¸­ã®å°‹å•ã‚’çµ‚ãˆãŸã€‚æ¬¡ã¯ã©ã†ã™ã‚‹ï¼Ÿ",
                    image: "interrogation_room",
                    choices: [
                        { text: "å…ƒç§˜æ›¸ã®éˆ´æœ¨ã‚’å°‹å•ã™ã‚‹", next: "interrogate_suzuki_1" },
                        { text: "ï¼ˆè¨¼æ‹ ãŒæƒã£ã¦ã„ã‚‹å ´åˆï¼‰çŠ¯äººã‚’å‘Šç™ºã™ã‚‹", next: "final_accusation", condition: () => inventory.size >= 2 }
                    ]
                },
                interrogate_suzuki_1: {
                    text: "éˆ´æœ¨ã¯ç¥çµŒè³ªãã†ã«ç›®ã‚’æ³³ãŒã›ã¦ã„ã‚‹ã€‚ã€Œå±±ä¸‹ã•ã‚“ã«ã¯ãŠä¸–è©±ã«ãªã‚Šã¾ã—ãŸãŒã€ä¸å½“ã«è§£é›‡ã•ã‚ŒãŸã‚“ã§ã™ï¼ã§ã‚‚ã€æ®ºã—ãŸã‚Šãªã‚“ã¦ã—ã¦ã„ã¾ã›ã‚“ï¼ã€",
                    image: "suspect_b",
                    choices: [
                        { text: "ï¼ˆè¡€ã®ä»˜ã„ãŸãƒŠã‚¤ãƒ•ã‚’æŒã£ã¦ã„ã‚‹å ´åˆï¼‰ã“ã®ãƒŠã‚¤ãƒ•ã«è¦‹è¦šãˆã¯ï¼Ÿ", next: "interrogate_suzuki_2", condition: () => inventory.has("è¡€ã®ä»˜ã„ãŸãƒŠã‚¤ãƒ•") },
                        { text: "è§£é›‡ã•ã‚ŒãŸç†ç”±ã‚’èã", next: "interrogate_suzuki_3" },
                        { text: "ç”°ä¸­ã«ã¤ã„ã¦å°‹ã­ã‚‹", next: "interrogate_suzuki_4" },
                        { text: "å°‹å•ã‚’çµ‚ãˆã‚‹", next: "scene_interrogate_start_after_suzuki" }
                    ]
                },
                interrogate_suzuki_2: {
                    text: "ãƒŠã‚¤ãƒ•ã‚’è¦‹ã›ã‚‹ã¨ã€éˆ´æœ¨ã¯æ¯ã‚’å‘‘ã‚“ã ã€‚ã€Œãã€ãã‚Œã¯...ç§ãŒä¼šç¤¾ã®çµ¦æ¹¯å®¤ã§ä½¿ã£ã¦ã„ãŸã‚‚ã®ã§ã™...ã§ã‚‚ã€ãªãœã“ã“ã«...ï¼Ÿã€å½¼å¥³ã¯æ˜ã‚‰ã‹ã«å‹•æºã—ã¦ã„ã‚‹ã€‚",
                    image: "suspect_b",
                    onEnter: () => addInventory("ãƒŠã‚¤ãƒ•ã¯éˆ´æœ¨ã®ã‚‚ã®"),
                    choices: [
                        { text: "è§£é›‡ã•ã‚ŒãŸç†ç”±ã‚’èã", next: "interrogate_suzuki_3" },
                        { text: "å°‹å•ã‚’çµ‚ãˆã‚‹", next: "scene_interrogate_start_after_suzuki" }
                    ]
                },
                interrogate_suzuki_3: {
                    text: "ã€Œæ¨ªé ˜ãªã‚“ã¦ã—ã¦ã„ã¾ã›ã‚“ï¼ã‚ã‚Œã¯ç”°ä¸­ã•ã‚“ãŒä»•çµ„ã‚“ã ç½ ã§ã™ï¼å½¼ãŒä¼šç¤¾ã®é‡‘ã‚’å‹•ã‹ã—ã¦ã€ç§ã«ç½ªã‚’ãªã™ã‚Šã¤ã‘ãŸã‚“ã§ã™ï¼ã€ã¨éˆ´æœ¨ã¯æ¶™ãªãŒã‚‰ã«è¨´ãˆãŸã€‚",
                    image: "suspect_b",
                    onEnter: () => addInventory("éˆ´æœ¨ã¯ç”°ä¸­ãŒçŠ¯äººã ã¨ä¸»å¼µ"),
                    choices: [
                        { text: "ç”°ä¸­ã«ã¤ã„ã¦å°‹ã­ã‚‹", next: "interrogate_suzuki_4" },
                        { text: "å°‹å•ã‚’çµ‚ãˆã‚‹", next: "scene_interrogate_start_after_suzuki" }
                    ]
                },
                 interrogate_suzuki_4: {
                    text: "ã€Œç”°ä¸­ã•ã‚“ã¯å±±ä¸‹ã•ã‚“ã®äº‹æ¥­ã‚’ä¹—ã£å–ã‚ã†ã¨ã—ã¦ã„ã¾ã—ãŸã€‚å±±ä¸‹ã•ã‚“ã‚‚æœ€è¿‘ãã‚Œã«æ°—ã¥ã„ã¦ã€å½¼ã‚’è­¦æˆ’ã—ã¦ã„ãŸã‚“ã§ã™ã€",
                    image: "suspect_b",
                    choices: [
                        { text: "å°‹å•ã‚’çµ‚ãˆã‚‹", next: "scene_interrogate_start_after_suzuki" }
                    ]
                },
                scene_interrogate_start_after_suzuki: {
                    text: "éˆ´æœ¨ã®å°‹å•ã‚’çµ‚ãˆãŸã€‚æ¬¡ã¯ã©ã†ã™ã‚‹ï¼Ÿ",
                    image: "interrogation_room",
                    choices: [
                        { text: "ãƒ“ã‚¸ãƒã‚¹ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã®ç”°ä¸­ã‚’å°‹å•ã™ã‚‹", next: "interrogate_tanaka_1" },
                        { text: "ï¼ˆè¨¼æ‹ ãŒæƒã£ã¦ã„ã‚‹å ´åˆï¼‰çŠ¯äººã‚’å‘Šç™ºã™ã‚‹", next: "final_accusation", condition: () => inventory.size >= 3 }
                    ]
                },
                final_accusation: {
                    text: "å…¨ã¦ã®èª¿æŸ»ãŒçµ‚ã‚ã£ãŸã€‚å›ãŒé›†ã‚ãŸè¨¼æ‹ ã¨è¨¼è¨€ã‹ã‚‰ã€çŠ¯äººã¯ç‰¹å®šã§ããŸã‹ï¼Ÿã•ã‚ã€å‘Šç™ºã®æ™‚ã ã€‚",
                    image: "interrogation_room",
                    choices: [
                        { text: "çŠ¯äººã¯ç”°ä¸­ã ï¼", next: "ending_tanaka" },
                        { text: "çŠ¯äººã¯éˆ´æœ¨ã ï¼", next: "ending_suzuki" }
                    ]
                },
                ending_tanaka: {
                    text: "å›ãŒç”°ä¸­ã‚’çªãã¤ã‘ã‚‹ã¨ã€å½¼ã¯è¦³å¿µã—ãŸã‚ˆã†ã«ç¬‘ã£ãŸã€‚ã€Œãã†ã ã€‚ç§ãŒã‚„ã£ãŸã€‚äº‹æ¥­ã‚’ä¹—ã£å–ã‚ã†ã¨ã—ã¦ã„ã‚‹ã“ã¨ã«å±±ä¸‹ãŒæ°—ã¥ã„ãŸã‹ã‚‰ã ã€‚è„…è¿«çŠ¶ã§éˆ´æœ¨ã«ç½ªã‚’ãªã™ã‚Šã¤ã‘ã€å½¼å¥³ã®ãƒŠã‚¤ãƒ•ã§...ã€è¦‹äº‹ãªæ¨ç†ã ã€‚äº‹ä»¶ã¯è§£æ±ºã—ãŸã€‚",
                    image: "ending_success",
                    isEnding: true,
                    condition: () => inventory.has("è„…è¿«çŠ¶") && inventory.has("ãƒŠã‚¤ãƒ•ã¯éˆ´æœ¨ã®ã‚‚ã®") && inventory.has("éˆ´æœ¨ã¯ç”°ä¸­ãŒçŠ¯äººã ã¨ä¸»å¼µ"),
                    fallback: "ending_fail_tanaka"
                },
                ending_suzuki: {
                    text: "å›ãŒéˆ´æœ¨ã‚’çŠ¯äººã ã¨å‘Šç™ºã™ã‚‹ã¨ã€å½¼å¥³ã¯æ³£ãå´©ã‚ŒãŸã€‚ã€Œé•ã†...ç§ã˜ã‚ƒãªã„...ã€ãã®å¾Œã€çœŸçŠ¯äººã§ã‚ã‚‹ç”°ä¸­ã¯æµ·å¤–ã¸é«˜é£›ã³ã—ã€äº‹ä»¶ã¯è¿·å®®å…¥ã‚Šã¨ãªã£ãŸã€‚å›ã®æ¨ç†ã¯é–“é•ã£ã¦ã„ãŸã€‚",
                    image: "ending_fail",
                    isEnding: true
                },
                ending_fail_tanaka: {
                    text: "å›ã¯ç”°ä¸­ã‚’å‘Šç™ºã—ãŸãŒã€æ±ºå®šçš„ãªè¨¼æ‹ ãŒè¶³ã‚Šãªã‹ã£ãŸã€‚ã€Œé¦¬é¹¿ãªã“ã¨ã‚’ã€‚è¨¼æ‹ ã§ã‚‚ã‚ã‚‹ã®ã‹ã­ï¼Ÿã€å½¼ã¯å¼è­·å£«ã‚’å‘¼ã³ã€å›ã¯æ‹…å½“ã‚’å¤–ã•ã‚ŒãŸã€‚çœŸçŠ¯äººã¯é—‡ã®ä¸­ã«æ¶ˆãˆãŸã€‚",
                    image: "ending_fail",
                    isEnding: true
                }
            };

            function startGame() {
                showScene('start');
            }

            function showScene(sceneId) {
                const scene = story[sceneId];
                
                // ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã®åˆ†å²å‡¦ç†
                if (scene.isEnding && scene.condition && !scene.condition()) {
                    showScene(scene.fallback);
                    return;
                }

                // UIæ›´æ–°
                imageContainer.innerHTML = images[scene.image] || '';
                textContainer.innerHTML = `<p>${scene.text}</p>`;
                choicesContainer.innerHTML = '';

                if (scene.onEnter) {
                    scene.onEnter();
                }

                if (scene.isEnding) {
                    const restartButton = document.createElement('button');
                    restartButton.innerText = 'ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤ã™ã‚‹';
                    restartButton.className = 'w-full bg-amber-500 hover:bg-amber-600 text-slate-900 font-bold py-3 px-4 rounded-lg transition-all duration-200 choice-button';
                    restartButton.onclick = () => {
                        inventory.clear();
                        updateInventory();
                        startGame();
                    };
                    choicesContainer.appendChild(restartButton);
                } else {
                    scene.choices.forEach(choice => {
                        if (choice.condition === undefined || choice.condition()) {
                            const button = document.createElement('button');
                            button.innerText = choice.text;
                            button.className = 'w-full bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 choice-button';
                            button.onclick = () => showScene(choice.next);
                            choicesContainer.appendChild(button);
                        }
                    });
                }
            }

            function addInventory(item) {
                inventory.add(item);
                updateInventory();
            }

            function updateInventory() {
                inventoryList.innerHTML = '';
                if (inventory.size === 0) {
                    inventoryList.appendChild(noEvidence);
                } else {
                    inventory.forEach(item => {
                        const li = document.createElement('li');
                        li.className = "bg-slate-800 px-3 py-1 rounded-full text-sm";
                        li.innerText = `ğŸ“„ ${item}`;
                        inventoryList.appendChild(li);
                    });
                }
            }

            startGame();
        });
    </script>
</body>
</html>
