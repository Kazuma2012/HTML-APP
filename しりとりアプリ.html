
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>しりとりアプリ ベータ版 1.2</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif; background: #f0f4f8; margin: 0; height: 100vh; display: flex; flex-direction: column; }
h1 { text-align: center; margin: 10px 0 6px 0; }
#score { text-align: center; font-weight: 600; margin-bottom: 10px; }
#log { flex: 1; background: #ffffff; border-radius: 12px; box-shadow: 0 6px 18px rgba(16,24,40,0.06); margin: 0 12px; padding: 14px; box-sizing: border-box; overflow-y: auto; }
.word { display: block; margin: 8px 0; padding: 10px 14px; border-radius: 14px; max-width: 74%; clear: both; word-break: break-word; animation: popIn 0.3s ease forwards; }
.user { background: #d1e7dd; float: right; text-align: right; }
.computer { background: #f8d7da; float: left; text-align: left; }
.system { background: #fff3cd; float: none; margin: 8px auto; text-align: center; max-width: 90%; }
.word.lose { background: #d3d3d3; font-weight: bold; }
#inputArea { display: flex; gap: 8px; padding: 10px; box-sizing: border-box; border-top: 1px solid #d1d5db; background: #f9fafb; }
#userInput { flex: 1; padding: 10px 12px; border-radius: 10px; border: 1px solid #d1d5db; font-size: 16px; }
button { padding: 10px 14px; border-radius: 10px; border: none; background: #2563eb; color: white; font-weight: 700; cursor: pointer; }
button:active { transform: translateY(1px); }
@keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 70% { transform: scale(1.2); opacity: 1; } 100% { transform: scale(1); } }
@keyframes scoreUp { 0% { transform: scale(1); } 50% { transform: scale(1.5); color: #f59e0b; } 100% { transform: scale(1); color: #000; } }

#resetBtn {
  position: fixed;
  top: 12px;
  right: 12px;
  padding: 8px 12px;
  border-radius: 10px;
  border: none;
  background: #f87171;
  color: white;
  font-weight: 700;
  cursor: pointer;
  z-index: 1000;
}
#resetBtn:active { transform: translateY(1px); }
</style>
</head>
<body>
<h1>しりとりアプリ ベータ版 1.2</h1>
<button id="resetBtn">もう一度プレイ</button>


    </select>
  </label>
</div>

<div id="score">スコア: 0</div>
<div id="log"></div>
<div id="inputArea">
  <input type="text" id="userInput" placeholder="言葉を入力（ひらがな・カタカナ可）" autofocus>
  <button id="sendBtn">送信</button>
</div>
<audio id="popSound" src="https://www.soundjay.com/button/sounds/button-3.mp3" preload="auto"></audio>
<script>
let words = [];
let score = 0;
let difficulty = 'normal';

// ===== 単語リスト（省略） =====
let computerWords = [

  // あ行
"あさり","あめ","あんず","あおむし","あひる","あかし","あかり","あずき","あさがお","あい","あか","あお","あかね","あじさい","あんこ",

// い行
"いちご","いぬ","いくら","いか","いそぎんちゃく","いちょう","いと","いわし","いも","いちじく","いずみ","いね","いし","いぬま","いちばん",

// う行
"うし","うさぎ","うなぎ","うめ","うどん","うずら","うきわ","うみ","うぐいす","うど","うに","うめぼし","うり","うさぎんぼ","うちわ",

// え行
"えび","えのき","えんぴつ","えがお","えだまめ","えき","えんとつ","えほん","えぼし","えぞ","えりまき","えんげき","えびす","えま","えいが",

// お行
"おにぎり","おおかみ","おちゃ","おかし","おさかな","おはな","おやつ","おんがく","おふろ","おに","おとこ","おんな","おうさま","おもちゃ","おおぞら",

// か行
"かめ","かに","かえる","かき","かつお","かぶ","かぼちゃ","かいがら","かさ","かんむり","かさご","かもめ","かがみ","かきごおり","かけら",

// き行
"きりん","きつね","きのこ","きんぎょ","きゃべつ","きび","きゅうり","きらめき","きんかん","きざみ","きつつき","きんとうん","きんちゃく","きく","きぼう",

// く行
"くま","くつ","くり","くさ","くじら","くろ","くも","くちばし","くわ","くるま","くがつ","くさか","くさり","くい","くせ",

// け行
"けむし","けん","けしごむ","けいと","けむり","けんだま","けんこう","けがわ","けしき","けんさ","けんちく","けんし","けいさつ","けんめい","けいさつかん",

// こ行
"こあら","こいぬ","こぶた","こま","こけ","こな","こねこ","こい","こだま","こぐま","こおり","こやま","こめ","こまち","こおろぎ",

// さ行
"さくら","さかな","さつまいも","さる","さとう","さやえんどう","さといも","さば","さつき","さざんか","さくらんぼ","さかなへん","さばかん","さくらもち","さとおや",

// し行
"しろ","しか","しんぶん","しまうま","しそ","しお","しゅうまい","しゃぼん","しんかんせん","しんごう","しんりん","しんせつ","しおり","しんじつ","しんせいじん",

// す行
"すいか","すずめ","すみれ","すし","すな","すいとん","すいせい","すもう","すりばち","すいとう","すなば","すいえい","すずしい","すなお","すきやき",

// せ行
"せみ","せんす","せっけん","せみしぐれ","せんたく","せんぷうき","せんろ","せいかつ","せんせい","せき","せんすいかん","せいと","せんもん","せいふく","せいかく",

// そ行
"そら","そらまめ","そで","そば","そよかぜ","そろばん","そんざい","そせん","そだち","そくてい","そしつ","そふ","そつぎょう","そなえ","そくほう",

// た行
"たまご","たぬき","たけのこ","たいやき","たこ","たんぽぽ","たいや","たきび","たおる","たび","たけ","たね","たつのおとしご","たらこ","たんとう",

// ち行
"ちょうちょ","ちかてつ","ちりめん","ちず","ちび","ちきゅう","ちょこれーと","ちょうこく","ちょうこ","ちいさい","ちゅうしゃ","ちえ","ちょうじょう","ちくわ","ちかみち",

// つ行
"つき","つくえ","つばめ","つみき","つな","つくし","つばさ","つる","つみ","つゆ","つち","つぼみ","つりざお","つなみ","つけもの",

// て行
"てがみ","てんとうむし","てぶくろ","てつどう","てまり","てっせん","てき","てんき","ていしゃ","てんし","てすり","てら","てんぐ","てあらい","てんまつ",

// と行
"とり","とまと","とら","とけい","とち","とんぼ","としょかん","とおり","とっきゅう","とおふ","ともしび","とっきょ","とびうお","とけいだい","とうもろこし",

// な行
"なす","なまえ","なみ","なわ","なべ","なつ","なまけもの","なかま","なぞ","なでしこ","なまこ","なぞなぞ","なかよし","なつやすみ","なみだ",

// に行
"にんじん","にわとり","にく","にじ","にんぎょう","にわ","にんにく","にんしょう","にんたい","にす","におい","にっき","にんこう","にしき","にがうり",

// ぬ行
"ぬの","ぬま","ぬいぐるみ","ぬけ","ぬけがら","ぬまえび","ぬまがえる","ぬりえ","ぬい","ぬのきれ","ぬまねこ","ぬのはん","ぬまふぐ","ぬまがき","ぬりもの",

// ね行
"ねこ","ねずみ","ねぎ","ねずこ","ねまき","ねぶか","ねんど","ねつき","ねがい","ねいろ","ねずのき","ねむのき","ねぶと","ねそべり","ねっこ",

// の行
"のり","のこぎり","のうさぎ","のき","のこ","のはら","のど","のらねこ","のりまき","のめり","のま","のえん","のこぎ","のりもの","のぞみ",

// は行
"はな","はち","はと","はまぐり","はし","はたけ","はこ","はやし","はんぶん","はも","はおり","はらぺこ","はくさい","はとぽっぽ","はしご",

// ひ行
"ひつじ","ひまわり","ひよこ","ひこうき","ひる","ひかり","ひょう","ひょうたん","ひと","ひょうしき","ひきだし","ひらがな","ひょうばん","ひも","ひじき",

// ふ行
"ふくろう","ふね","ふとん","ふじ","ふで","ふえ","ふき","ふうせん","ふとし","ふろ","ふるさと","ふきん","ふるい","ふかひれ","ふるう",

// へ行
"へび","へや","へいわ","へいき","へんか","へんとう","へいきん","へんしん","へんすう","へやぎ","へんみん","へいわぼう","へいおう","へんしゅう","へいこう",

// ほ行
"ほし","ほたる","ほうき","ほね","ほうせき","ほっきょくぐま","ほうとう","ほそく","ほかげ","ほうれんそう","ほおずき","ほたて","ほうたい","ほおば","ほおん",

// ま行
"まつ","まめ","まぐろ","まくら","まき","まち","まど","まつたけ","まがたま","まきば","まいご","まる","まわり","まつり","まなぶ",

// み行
"みかん","みず","みつばち","みのむし","みかづき","みやげ","みみず","みどり","みょうが","みずうみ","みやこ","みつろう","みね","みずたま","みかづき",

// む行
"むし","むぎ","むらさき","むこう","むね","むかし","むれ","むぎわら","むこうがわ","むこうみず","むこうまち","むしば","むすめ","むかで","むすび",

// め行
"めだか","めがね","めんたいこ","めいろ","めも","めだま","めいさく","めんきょ","めいぶつ","めいし","めんどう","めんきん","めいじん","めいせい","めぐみ",

// も行
"もも","もり","もぐら","もくせい","もけい","もやし","もみじ","もんすたー","もよう","もけら","もぐもぐ","もくひょう","もんだい","もんよう","もんち",

// や行
"やま","やさい","やどかり","やき","やきいも","やくそく","やぎ","やね","やしき","やみ","やすみ","やまのこ","やまびこ","やし","やぶ",

// ゆ行
"ゆき","ゆびわ","ゆめ","ゆでたまご","ゆか","ゆうひ","ゆうえんち","ゆうびんきょく","ゆみ","ゆうしゃ","ゆうき","ゆうかん","ゆうがた","ゆうすげ","ゆうどう",

// よ行
"よる","よつば","よこ","よぞら","よせぎ","よろこび","よし","よせん","よく","よこがお","よい","よこはま","よみかた","よいしょ","よあけ",

// ら行
"らいおん","らっこ","らくがき","らくだ","らん","らいしゅう","らせん","らんぼう","らいねん","らくえん","らんちゅう","らくだい","らんげき","らんこう","らくだ",

// り行
"りんご","りす","りんどう","りょうり","りっぱ","りきゅう","りかい","りょうせい","りんぷん","りんしょう","りょうて","りんき","りょうほう","りきし","りんね",

// る行
"るり","るす","るすばん","るいすい","るいけい","るいせき","るすや","るいけん","るいせん","るりいろ","るいめん","るすきょく","るいしょう","るいし","るいこう",

// れ行
"れもん","れんげ","れきし","れんらく","れいぞうこ","れっしゃ","れんあい","れいぶん","れんしゅう","れいぎ","れきぶん","れんじつ","れいこう","れんが","れんげそう",

// ろ行
"ろうそく","ろば","ろけっと","ろくがつ","ろせん","ろてん","ろしあ","ろうか","ろじうら","ろせんき","ろせんばし","ろせんじ","ろせんぐ","ろうかん","ろせんめい",

// わ行
"わに","わかめ","わらび","わし","わごむ","わら","わすれもの","わにざめ","わにょう","わらべ","わかば","わこう","わきみず","わごん","わな",

//その他

// が行
"がちょう","がまぐち","がいこつ","がけ","がらす","がま","がんばり","がくせい","がんだん","がいこく","がき","がけっぷち","がんき","がすい","がっこう",

// ぎ行
"ぎんこう","ぎゅうにゅう","ぎんいろ","ぎょうざ","ぎんこういん","ぎゃくてん","ぎんなん","ぎょうれつ","ぎょし","ぎんざ","ぎょこう","ぎゅっと","ぎょうむ","ぎょにく","ぎょかい",

// ぐ行
"ぐんて","ぐらす","ぐんそう","ぐるま","ぐみ","ぐんま","ぐんじょう","ぐい","ぐらんど","ぐんけい","ぐるぐる","ぐんたい","ぐんそうぶ","ぐんき","ぐんかん",

// げ行
"げんき","げんかん","げっこう","げんそう","げき","げきじょう","げいじゅつ","げきだん","げきむ","げんち","げんざい","げんきん","げんめい","げんえき","げんちょう",

// ご行
"ごりら","ごま","ごはん","ごうかく","ごまんと","ごこう","ごらく","ごせん","ごじゅう","ごみ","ごこうき","ごせい","ごうどう","ごけん","ごよう",

// ぱ行
"ぱんだ","ぱいなっぷる","ぱん","ぱそこん","ぱちんこ","ぱらそる","ぱんつ","ぱんけーき","ぱっち","ぱらだいす","ぱいろっと","ぱんぷきん","ぱっく","ぱっしょん","ぱれーど",

// ぴ行
"ぴかちゅう","ぴあの","ぴんく","ぴよぴよ","ぴったり","ぴかぴか","ぴーす","ぴったんこ","ぴんぼけ","ぴよ","ぴんきー","ぴーひゃら","ぴんき","ぴーすけ","ぴくにっく",

// ぷ行
"ぷりん","ぷーる","ぷれぜんと","ぷち","ぷっちん","ぷらす","ぷろぐらむ","ぷろぺら","ぷらねっと","ぷれみあむ","ぷろていん","ぷろとこる","ぷりんと","ぷりんせす","ぷりんたー",

// ぺ行
"ぺんぎん","ぺん","ぺんき","ぺこ","ぺったんこ","ぺんだんと","ぺーす","ぺんしる","ぺんきょう","ぺろ","ぺーぱー","ぺいんと","ぺこぱ","ぺたん","ぺんきん",

// ぽ行
"ぽすと","ぽけっと","ぽにー","ぽんず","ぽけもん","ぽん","ぽりす","ぽっぷ","ぽいんと","ぽっち","ぽんた","ぽにょ","ぽち","ぽんぷ","ぽけっとぼーる",

//新ワード

"あいす","あおぞら","あかちゃん","あき","あさがお","あし","あそび","あめ","あんぱん","あんぜん",
"いぬ","いす","いちご","いも","いわ","いんげん","いろ","いわし","いか","いもうと",
"うさぎ","うみ","うし","うどん","うた","うで","うめ","うえき","うわぎ","うさぎのえ",
"えんぴつ","えび","えき","えがお","えだ","えほん","えのぐ","えいが","えん","えのき",
"おに","おかし","おちゃ","おさけ","おふろ","おはな","おとこ","おんな","おにぎり","おおかみ",
"かさ","かめ","かばん","かぞく","かみ","かき","かぜ","かいしゃ","かりん","かんらんしゃ",
"きつね","きのこ","きゅうり","きんぎょ","きりん","きもち","きおく","きせつ","きれい","きずな",
"くつ","くま","くさ","くるま","くも","くに","くじら","くち","くろ","くるみ",
"けむし","けしごむ","けんか","けいさつ","けいたい","けん","けが","けむり","けんどう","けんしゅう",
"こあら","こども","こめ","ことり","こいぬ","こぶた","こけし","こえ","こころ","こま",
"さくら","さかな","さとう","さる","さと","さむらい","さつまいも","さんぽ","さお","さじ",
"しお","しろ","しまうま","しんぶん","しんかんせん","しずく","しょくぶつ","しゃしん","しあわせ","しっぽ",
"すいか","すずめ","すな","すみ","すいとう","すこし","すきやき","すもう","すてき","すぐれもの",
"せみ","せんせい","せっけん","せかい","せんたく","せき","せんぷうき","せんろ","せきにん","せいかつ",
"そら","そふ","そと","そば","そつぎょう","そっけつ","そんざい","そくたつ","そろばん","そよかぜ",
"たまご","たぬき","たこ","たいよう","たき","たんぽぽ","たけ","たび","たて","たんじょうび",
"ちず","ちかてつ","ちょうちょ","ちから","ちゅうしゃ","ちょきん","ちょうこく","ちいさい","ちょうし","ちょこれーと",
"つき","つなみ","つくえ","つま","つばさ","つめ","つち","つる","つうしん","つり",
"てがみ","てんき","てつどう","てぶくろ","てんとうむし","てまえ","てんじょう","てき","てんさい","ていねい",
"とり","とけい","とまと","としょかん","となり","とびら","とうきょう","とんぼ","とけいだい","とおり",
"なす","なみ","なわ","なつ","なかま","なぞ","なぞなぞ","なみだ","なに","なまえ",
"にんじん","にわ","にく","におい","にほん","にんぎょう","にし","にじ","にゅうがく","にっき",
"ぬいぐるみ","ぬま","ぬの","ぬける","ぬまえ","ぬりえ","ぬまがさ","ぬのざいく","ぬけがら","ぬいどり",
"ねこ","ねずみ","ねつ","ねむり","ねだん","ねんど","ねぎ","ねんし","ねっこ","ねんりょう",
"のり","のこぎり","のはら","のうさぎ","のど","のりもの","のんびり","のうりょく","のうみそ","のうえん",
"はな","はさみ","はし","はこ","はち","はら","はやし","はっぱ","はたけ","はじめ",
"ひつじ","ひこうき","ひまわり","ひと","ひざ","ひげ","ひかり","ひょう","ひつよう","ひも",
"ふね","ふくろ","ふとん","ふで","ふじ","ふるさと","ふうせん","ふうりん","ふだ","ふきん",
"へび","へや","へんしん","へいわ","へんきゃく","へやしき","へんたい","へいき","へやづくり","へいぞう",
"ほし","ほね","ほうき","ほたる","ほうせき","ほうちょう","ほしい","ほっとけーき","ほこり","ほうりつ",
"まめ","まくら","まち","まど","まつり","まんが","まほう","まねきねこ","まる","まご",
"みかん","みず","みみ","みち","みせ","みょうじ","みなみ","みんぞく","みょうじん","みそ",
"むし","むね","むらさき","むこう","むぎ","むねあて","むすめ","むりょう","むかし","むこうがわ",
"めだか","めがね","めいろ","めん","めざましどけい","めだま","めも","めいさい","めだつ","めし",
"もも","もり","もぐら","もん","もえぎ","もたい","もじ","もくようび","もらいもの","もと",
"やま","やさい","やきゅう","やど","やね","やけど","やくそく","やすみ","やじるし","やくざ",
"ゆき","ゆめ","ゆび","ゆうびんきょく","ゆかた","ゆうえんち","ゆうき","ゆでたまご","ゆびわ","ゆうしゃ",
"よる","よこ","よてい","ようちえん","ようふく","よわむし","よつば","よやく","よぶん","よさこい",
"がいこつ","がっこう","ぎゅうにく","ぎんこう","ぐんたい","げんかん","ごはん","ざっし","じどうしゃ","ずきん",
"ぜんまい","ぞう","だいこん","だんご","でんしゃ","ばなな","びーる","ぶた","べんとう","ぼうし",
"ぱん","ぴあの","ぷりん","ぺん","ぽすと","かがみ","がいこつ","かぎ","がっこう","かぐ","かぜ","きがえ","ぎゅうにく","きんぎょ","きょだい",
"くがつ","ぐんたい","けが","げんかん","ごはん","こがね","ごま","さがしもの","ざっし","しがつ",
"じどうしゃ","ずきん","せがれ","ぜんまい","そうじ","ぞう","たがやす","だいこん","だんご","ちがい",
"ぢかん","つづく","てがみ","でんしゃ","とがめる","どらやき","ながれ","にがうり","にぎり","ぬがす",
"ねがい","のがす","はがき","ばくだん","ひがし","びょういん","ふがいない","ぶどう","べんとう","ぼうし",
"ぱんだ","ぴあの","ぷりん","ぺんぎん","ぽすと","まがりかど","みがく","むがい","めがね","もがく",
"やがて","ゆがむ","よがんばれ","らがし","りがい","るがい","れがい","ろがい","わがまま","をがい",
"あがり","あぎと","あぐら","あげもの","あごひげ","いがい","いぎ","いぐさ","いげん","いごこち",
"うがい","うぎ","うぐいす","うげん","うごき","えがく","えぎ","えぐみ","えげつない","えごま",
"おがみ","おぎゃあ","おぐら","おげんき","おごり","かがやき","かぎり","かぐら","かげ","かご",
"きがえる","きぎょう","きぐん","きげん","きごころ","くがい","くぎり","くぐる","くげん","くごう",
"けがれ","けぎれ","けぐるい","けげん","けごむ","こがす","こぎつね","こぐま","こげ","こごみ",
"さがし","さぎょう","さぐる","さげる","さご","しがみつく","しぎょう","しぐさ","しげき","しごと",
"すがた","すぎる","すぐれもの","すげ","すごもり","せがい","せぎ","せぐ","せげん","せごどん",
"そがい","そぎ","そぐ","そげ","そごう","たがやす","たぎる","たぐる","たげき","たご",
"ちがい","ちぎる","ちぐさ","ちげ","ちご","つがい","つぎ","つぐ","つげ","つごう",
"てがみ","てぎわ","てぐす","てげん","てごろ","とがる","とぎれ","とぐ","とげ","とごし",
"どがい","どぎつい","どぐう","どげざ","どご","ながい","なぎさ","なぐさめ","なげき","なごや",
"にがい","にぎり","にぐる","にげる","にごり","ぬがす","ぬぎもの","ぬぐい","ぬげ","ぬごむ",
"ねがう","ねぎる","ねぐせ","ねげん","ねごと","のがす","のぎく","のぐさ","のげん","のごむ",
"はがね","はぎれ","はぐくむ","はげしい","はごろも","ばがけん","ばぎん","ばぐる","ばげき","ばご",
"ひがえり","ひぎょう","ひぐらし","ひげ","ひげき","びがい","びぎなー","びぐま","びげん","びご",
"ふがいない","ふぎょう","ふぐ","ふげん","ふご","ぶがい","ぶぎょう","ぶぐん","ぶげん","ぶご",
"べがい","べぎ","べぐ","べげ","べご","ぼがい","ぼぎ","ぼぐ","ぼげ","ぼご",
"ぱがん","ぱぎん","ぱぐ","ぱげ","ぱご","ぴがい","ぴぎ","ぴぐ","ぴげ","ぴご",
"ぷがい","ぷぎ","ぷぐ","ぷげ","ぷご","ぺがい","ぺぎ","ぺぐ","ぺげ","ぺご",
"ぽがい","ぽぎ","ぽぐ","ぽげ","ぽご","まがり","まぎれる","まぐまぐ","まげき","まごころ",
"みがく","みぎわ","みぐるみ","みげき","みごと","むがい","むぎゅう","むぐむ","むげん","むごい",
"めがける","めぎる","めぐむ","めげる","めごろ","もがく","もぎる","もぐら","もげる","もごもご",
"やがて","やぎ","やぐ","やげん","やご","ゆがむ","ゆぎ","ゆぐ","ゆげん","ゆご",
"よがんばれ","よぎる","よぐ","よげ","よごす","らがし","らぎ","らぐ","らげ","らご",
"りがい","りぎ","りぐ","りげ","りご","るがい","るぎ","るぐ","るげ","るご",
"れがい","れぎ","れぐ","れげ","れご","ろがい","ろぎ","ろぐ","ろげ","ろご",
"わがまま","わぎ","わぐ","わげ","わご","をがい","をぎ","をぐ","をげ","をご",


"ずかん","ずきん","ずもう","ずた袋","ずいぶん","ずけい","ずのう","ずらす","ずっと","ずんどう",

]; // 簡略化

function toHiragana(str){ return str.replace(/[\u30A1-\u30F6]/g, ch => String.fromCharCode(ch.charCodeAt(0)-0x60)).toLowerCase(); }
function normalizeWord(raw){ let w = raw.trim(); if(!w) return ''; w = toHiragana(w).replace(/\s+/g,'').replace(/ー/g,''); return w; }

// 小文字→大文字変換
function normalizeLastChar(char){
  const smallToLarge = {
    'ゃ':'や','ゅ':'ゆ','ょ':'よ',
    'ぁ':'あ','ぃ':'い','ぅ':'う','ぇ':'え','ぉ':'お',
    'っ':'つ'
  };
  return smallToLarge[char] || char;
}

function isValidNextWord(userWord, candidate){
  if(!userWord) return true;
  const lastChar = normalizeLastChar(userWord.slice(-1)); // ←ここで変換
  const firstChar = candidate.slice(0,1);
  return lastChar === firstChar && !words.includes(candidate);
}

function resetGame(){
  words = [];
  score = 0;
  document.getElementById('log').innerHTML = '';
  updateScore();
  document.getElementById('userInput').disabled = false;
  document.getElementById('sendBtn').disabled = false;
  addWord('システム','ゲームをリセットしました！もう一度スタート','system');
}

function endGame(message){
  addWord('システム', message, 'system');
  document.getElementById('userInput').disabled = true;
  document.getElementById('sendBtn').disabled = true;
}

function chooseComputerWord(userWord){
  let candidates = computerWords.filter(w => isValidNextWord(userWord, w) && !words.includes(w));
  if(candidates.length === 0) return null;
  return candidates[Math.floor(Math.random() * candidates.length)];
}

function play(){
  const input = document.getElementById('userInput');
  let raw = input.value;
  if(!raw) return;
  const word = normalizeWord(raw);
  input.value=''; input.focus();
  if(!word) return;

  if(words.length > 0){
    const lastWord = words[words.length - 1];
    const lastChar = normalizeLastChar(lastWord.slice(-1));
    if(word[0] !== lastChar){
      addWord('システム','前の言葉とつながっていないよ','system');
      return;
    }
  }

  if(words.includes(word)){ addWord('システム','その言葉は既に使われているよ','system'); return; }

  addWord('あなた', word, 'user'); words.push(word); score++; updateScore();
  if(word.endsWith('ん')){ endGame('「ん」で終わったので負け'); return; }

  const reply = chooseComputerWord(word);
  if(reply){ 
    addWord('コンピュータ', reply, 'computer'); 
    words.push(reply); 
    score++; updateScore(); 
    if(reply.endsWith('ん')) endGame('コンピュータが「ん」で終わったので勝ち'); 
  }
  else endGame('コンピュータが答えを見つけられない');
}

function addWord(player,text,type){
  const log=document.getElementById('log');
  const div=document.createElement('div');
  div.className='word '+type;
  div.textContent=player+': '+text;
  log.appendChild(div);
  log.scrollTop=log.scrollHeight;
  const popSound = document.getElementById('popSound');
  popSound.pause();
  popSound.currentTime = 0;
  popSound.play();
}

function updateScore(){
  const scoreEl=document.getElementById('score');
  scoreEl.textContent='スコア: '+score;
  scoreEl.style.animation='scoreUp 0.5s ease';
  setTimeout(()=>{ scoreEl.style.animation=''; },500);
}

document.getElementById('userInput').addEventListener('keydown', e=>{if(e.key==='Enter') play()});
document.getElementById('sendBtn').addEventListener('click', play);
document.getElementById('resetBtn').addEventListener('click', resetGame);
document.getElementById('difficultySelect').addEventListener('change', e=>{
  difficulty = e.target.value;
  addWord('システム','難易度を「'+e.target.options[e.target.selectedIndex].text+'」に変更しました','system');
});
</script>
</body>
</html>
